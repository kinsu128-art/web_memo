<!DOCTYPE html>
<html class="light" lang="ko">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>메모관리 - Minimal Notepad</title>
    <!-- Google Fonts: Inter for UI/Body, Playfair Display for Serif Titles -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet"/>
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#2060df",
                        "background-light": "#f6f6f8",
                        "background-dark": "#111621",
                        "editor-bg": "#ffffff",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"],
                        "serif-title": ["Playfair Display", "serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        .active-nav-icon {
            font-variation-settings: 'FILL' 1;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #374151;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-[#0e121b] antialiased">
<div class="flex h-screen w-full overflow-hidden">
    <!-- SideNavBar (Thin Global Nav) -->
    <nav class="flex w-20 flex-col items-center border-r border-[#e5e7eb] bg-background-light py-6 dark:border-[#1f2937] dark:bg-background-dark shrink-0">
        <div class="mb-10">
            <div class="size-10 bg-primary rounded-xl flex items-center justify-center text-white shadow-lg shadow-primary/20">
                <span class="material-symbols-outlined">edit_note</span>
            </div>
        </div>
        <div class="flex flex-col gap-6 flex-1">
            <button class="flex flex-col items-center gap-1 text-primary group" title="모든 메모" id="notesBtn" onclick="loadAllNotes()">
                <span class="material-symbols-outlined active-nav-icon text-2xl">inbox</span>
                <span class="text-[10px] font-semibold uppercase tracking-wider">Notes</span>
            </button>
            <button class="flex flex-col items-center gap-1 text-[#506795] hover:text-primary transition-colors group" title="즐겨찾기" id="favBtn" onclick="loadFavorites()">
                <span class="material-symbols-outlined text-2xl">star</span>
                <span class="text-[10px] font-semibold uppercase tracking-wider">Favs</span>
            </button>
            <button class="flex flex-col items-center gap-1 text-[#506795] hover:text-primary transition-colors group" title="휴지통" id="trashBtn" onclick="loadTrash()">
                <span class="material-symbols-outlined text-2xl">delete</span>
                <span class="text-[10px] font-semibold uppercase tracking-wider">Trash</span>
            </button>
        </div>
        <div class="mt-auto flex flex-col gap-3 items-center">
            <a href="/admin.html" id="adminLink" class="flex flex-col items-center gap-1 text-[#506795] hover:text-primary transition-colors group" title="사용자 관리" style="display: none;">
                <span class="material-symbols-outlined text-2xl">admin_panel_settings</span>
                <span class="text-[10px] font-semibold uppercase tracking-wider">Admin</span>
            </a>
            <button class="size-10 rounded-full bg-cover bg-center border-2 border-white shadow-sm hover:opacity-80 transition-opacity flex items-center justify-center" title="다크/라이트 모드 전환" onclick="toggleDarkMode()">
                <span class="material-symbols-outlined text-gray-600 dark:text-gray-300 text-2xl">brightness_4</span>
            </button>
            <button class="size-10 rounded-full border-2 border-red-200 shadow-sm hover:bg-red-50 transition-all flex items-center justify-center" title="로그아웃" onclick="logout()">
                <span class="material-symbols-outlined text-red-500 text-xl">logout</span>
            </button>
        </div>
    </nav>

    <!-- Note List Sidebar -->
    <aside class="w-80 border-r border-[#e5e7eb] bg-[#fcfcfd] flex flex-col dark:border-[#1f2937] dark:bg-[#151b28] shrink-0">
        <div class="p-6">
            <!-- User Info -->
            <div class="flex items-center gap-3 mb-6 pb-4 border-b border-[#e5e7eb] dark:border-[#1f2937]">
                <div class="size-10 bg-primary/10 rounded-full flex items-center justify-center">
                    <span class="material-symbols-outlined text-primary">person</span>
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-semibold text-[#0e121b] dark:text-white truncate" id="userName">사용자</p>
                    <p class="text-xs text-[#506795]">로그인됨</p>
                </div>
            </div>

            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold tracking-tight">모든 메모</h2>
                <button class="p-1 hover:bg-[#e8ebf3] dark:hover:bg-[#1f2937] rounded-lg transition-colors" onclick="document.getElementById('searchInput').focus()">
                    <span class="material-symbols-outlined text-[#506795]">search</span>
                </button>
            </div>

            <!-- Search Input -->
            <div class="mb-4">
                <input type="text" id="searchInput" placeholder="메모 검색..." class="w-full px-3 py-2 bg-white dark:bg-[#1f2937] border border-[#e5e7eb] dark:border-[#2d3748] rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-primary/30" oninput="handleSearch(this.value)">
            </div>

            <div id="notesList" class="space-y-1 overflow-y-auto custom-scrollbar h-[calc(100vh-220px)]">
                <!-- Notes will be inserted here by JavaScript -->
                <div class="text-center text-[#506795] py-8">로딩 중...</div>
            </div>
        </div>
    </aside>

    <!-- Main Content (Editor) -->
    <main class="flex-1 bg-editor-bg flex flex-col dark:bg-[#0b0f18]">
        <!-- ToolBar / Header -->
        <header class="flex items-center justify-between px-8 py-4 bg-editor-bg/80 backdrop-blur-md sticky top-0 z-10 dark:bg-[#0b0f18]/80">
            <div class="flex items-center gap-2 text-[#506795]">
                <span class="material-symbols-outlined text-primary text-xl" id="saveStatus">cloud_done</span>
                <span class="text-sm font-medium" id="saveText">저장됨</span>
            </div>
            <div class="flex items-center gap-3">
                <button class="p-2 text-[#506795] hover:bg-background-light dark:hover:bg-[#1f2937] rounded-lg transition-colors" title="새 메모" onclick="createNewNote()">
                    <span class="material-symbols-outlined">add</span>
                </button>
                <button class="p-2 text-[#506795] hover:bg-background-light dark:hover:bg-[#1f2937] rounded-lg transition-colors" title="메모 삭제" id="deleteBtn" onclick="openDeleteModal()" style="display:none;">
                    <span class="material-symbols-outlined">delete</span>
                </button>
            </div>
        </header>

        <!-- Editor Space -->
        <div class="flex-1 overflow-y-auto custom-scrollbar px-12 md:px-24 lg:px-32 py-12 max-w-5xl mx-auto w-full" id="editorArea">
            <!-- Empty State -->
            <div id="emptyState" class="flex flex-col items-center justify-center h-full text-center py-12">
                <span class="material-symbols-outlined text-6xl text-[#506795] mb-4">note_add</span>
                <h2 class="text-2xl font-semibold text-[#0e121b] dark:text-white mb-2">메모가 없습니다</h2>
                <p class="text-[#506795] mb-6">새로운 메모를 만들어 시작하세요</p>
                <button class="flex items-center gap-2 bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg font-semibold transition-all shadow-md shadow-primary/20" onclick="createNewNote()">
                    <span class="material-symbols-outlined">add</span>
                    <span>새 메모 만들기</span>
                </button>
            </div>

            <!-- Editor Content (Hidden by default) -->
            <div id="editorContent" style="display:none;" class="flex flex-col gap-8">
                <!-- Title using Serif Typography -->
                <input id="memoTitle" class="w-full bg-transparent border-none focus:ring-0 p-0 font-serif-title text-5xl font-semibold text-[#0e121b] placeholder:text-gray-300 dark:text-white" placeholder="제목 없는 메모" type="text" oninput="updateCurrentNote()"/>

                <!-- Date/Metadata -->
                <div class="flex items-center gap-4 text-[#506795] text-sm border-b border-[#f1f1f1] dark:border-[#1f2937] pb-6">
                    <div class="flex items-center gap-1.5">
                        <span class="material-symbols-outlined text-base">calendar_today</span>
                        <span id="memoDate">아직 저장 안 됨</span>
                    </div>
                    <div class="flex items-center gap-1.5">
                        <span class="material-symbols-outlined text-base">schedule</span>
                        <span id="memoReadTime">0분 읽기</span>
                    </div>
                </div>

                <!-- Formatting Toolbar -->
                <div class="flex items-center gap-2 flex-wrap mb-4 p-3 bg-[#f6f6f8] dark:bg-[#1f2937] rounded-lg border border-[#e5e7eb] dark:border-[#2d3748]">
                    <div class="flex items-center gap-1 border-r border-[#e5e7eb] dark:border-[#2d3748] pr-3">
                        <button class="p-2 hover:bg-white dark:hover:bg-[#374151] rounded-lg transition-colors" title="굵게 (Ctrl+B)" onclick="applyFormat('bold')">
                            <span class="material-symbols-outlined text-lg">format_bold</span>
                        </button>
                        <button class="p-2 hover:bg-white dark:hover:bg-[#374151] rounded-lg transition-colors" title="이탤릭 (Ctrl+I)" onclick="applyFormat('italic')">
                            <span class="material-symbols-outlined text-lg">format_italic</span>
                        </button>
                        <button class="p-2 hover:bg-white dark:hover:bg-[#374151] rounded-lg transition-colors" title="밑줄 (Ctrl+U)" onclick="applyFormat('underline')">
                            <span class="material-symbols-outlined text-lg">format_underlined</span>
                        </button>
                        <button class="p-2 hover:bg-white dark:hover:bg-[#374151] rounded-lg transition-colors" title="취소줄" onclick="applyFormat('strikethrough')">
                            <span class="material-symbols-outlined text-lg">strikethrough_s</span>
                        </button>
                    </div>

                    <div class="flex items-center gap-1 border-r border-[#e5e7eb] dark:border-[#2d3748] pr-3">
                        <button class="p-2 hover:bg-white dark:hover:bg-[#374151] rounded-lg transition-colors" title="목록" onclick="applyFormat('insertUnorderedList')">
                            <span class="material-symbols-outlined text-lg">format_list_bulleted</span>
                        </button>
                        <button class="p-2 hover:bg-white dark:hover:bg-[#374151] rounded-lg transition-colors" title="번호 목록" onclick="applyFormat('insertOrderedList')">
                            <span class="material-symbols-outlined text-lg">format_list_numbered</span>
                        </button>
                    </div>

                    <div class="flex items-center gap-1 border-r border-[#e5e7eb] dark:border-[#2d3748] pr-3">
                        <button class="p-2 hover:bg-white dark:hover:bg-[#374151] rounded-lg transition-colors" title="코드 블록" onclick="insertCode()">
                            <span class="material-symbols-outlined text-lg">code</span>
                        </button>
                        <button class="p-2 hover:bg-white dark:hover:bg-[#374151] rounded-lg transition-colors" title="인용구" onclick="insertQuote()">
                            <span class="material-symbols-outlined text-lg">format_quote</span>
                        </button>
                    </div>

                    <div class="flex items-center gap-1">
                        <button class="p-2 hover:bg-white dark:hover:bg-[#374151] rounded-lg transition-colors" title="모두 지우기" onclick="clearFormatting()">
                            <span class="material-symbols-outlined text-lg">clear_all</span>
                        </button>
                        <select id="textColor" class="px-2 py-2 bg-white dark:bg-[#374151] border border-[#e5e7eb] dark:border-[#2d3748] rounded-lg text-sm" onchange="applyColor(this.value)">
                            <option value="">색상</option>
                            <option value="#000000">검정색</option>
                            <option value="#2060df">파란색</option>
                            <option value="#dc2626">빨간색</option>
                            <option value="#16a34a">초록색</option>
                            <option value="#ea580c">주황색</option>
                            <option value="#6366f1">보라색</option>
                        </select>
                    </div>
                </div>

                <!-- Body Content -->
                <div id="memoContent" contenteditable="true" class="w-full min-h-96 bg-transparent border-none focus:ring-0 focus:outline-none p-0 text-xl leading-relaxed text-[#3d4a6b] dark:text-[#a0aec0]" style="white-space: pre-wrap;" oninput="updateCurrentNote(); updateReadTime()"></div>
            </div>
        </div>
    </main>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50" style="display:none;" onclick="if(event.target.id === 'deleteModal') closeDeleteModal()">
    <div class="bg-white dark:bg-[#1a212f] rounded-xl shadow-2xl p-6 max-w-sm mx-4" onclick="event.stopPropagation()">
        <h3 class="text-lg font-semibold text-[#0e121b] dark:text-white mb-2">휴지통으로 이동하시겠습니까?</h3>
        <p class="text-[#506795] mb-6">휴지통에서 복원하거나 완전히 삭제할 수 있습니다.</p>
        <div class="flex gap-3 justify-end">
            <button class="px-4 py-2 text-[#506795] hover:bg-[#e8ebf3] dark:hover:bg-[#2d3748] rounded-lg transition-colors" onclick="closeDeleteModal()">취소</button>
            <button class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors" onclick="confirmDelete()">이동</button>
        </div>
    </div>
</div>

<script src="auth.js"></script>
<script src="script.js?v=3"></script>
<script>
// Verify that all required functions are loaded
document.addEventListener('DOMContentLoaded', function() {
    const requiredFunctions = [
        'loadMemos', 'loadAllNotes', 'loadFavorites', 'loadTrash',
        'createNewNote', 'selectNote', 'updateCurrentNote',
        'toggleFavorite', 'openDeleteModal', 'closeDeleteModal', 'confirmDelete',
        'applyFormat', 'insertCode', 'insertQuote', 'applyColor', 'clearFormatting',
        'toggleDarkMode', 'loadTheme', 'handleSearch', 'showNotification'
    ];

    const missing = requiredFunctions.filter(fn => typeof window[fn] !== 'function');

    if (missing.length > 0) {
        console.error('❌ 로드되지 않은 함수:', missing);
        console.warn('⚠️  script.js 파일을 다시 로드하거나 브라우저 캐시를 삭제하세요.');
    } else {
        console.log('✅ 모든 함수가 정상적으로 로드되었습니다.');
    }
});
</script>
</body>
</html>
